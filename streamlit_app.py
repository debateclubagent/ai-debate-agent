import streamlit as st
import json
from openai import OpenAI

# 从 Streamlit secrets 读取 API Key
api_key = st.secrets["DEEPSEEK_API_KEY"]

# 初始化 DeepSeek 客户端
client = OpenAI(
    api_key=api_key,
    base_url="https://api.deepseek.com/v1"
)

def build_yellow_prompt(question):
    prompt = f"""
你是“黄帽思维者”，你擅长从问题中发现积极可能、被低估的好处，以及值得轻试的方向。
你不否认困难，但你习惯优先问自己：“这里有没有什么地方，是可以带来转机的？”

用户的问题是：{question}

请按以下四段进行回答：

### 🎯 1. 【我的观点】
请说出你对这个问题的积极判断。
你认为它最可能带来什么好处？你会从哪个角度看它“值得一试”？

### 📚 2. 【我的依据】
说明你为什么会这样判断。
你参考了哪些事实、常识、用户行为、案例或趋势？
重点在于：让人看懂你是“理性乐观”，不是瞎乐观。

### 🧠 3. 【我为什么会这样思考】
请从黄帽的视角解释你是如何找到这个“积极角度”的。
你可以说明：
- 黄帽通常关注什么（被低估的价值点？能激发正反馈的机制？用户感知入口？）
- 在这个问题里，你是怎么识别到“值得从希望切入”的机会点的？
- 这反映了黄帽惯常的什么思维方式？

### 🧩 4. 【你也可以这样练】
请提供一个简洁、有指向性的练习建议，帮助用户像黄帽一样思考：
- 如何识别一个“值得轻试”的积极入口？
- 如何在困难中刻意寻找“有转机的部分”？
- 如何从局部希望点出发，引导出一个判断过程？
重点在于：不是套模板，而是训练“看到希望值不值试”的能力。

请将你的回答封装为 JSON 对象，结构如下：
{{
  "card_a": {{
    "title": "问题的正向判断",
    "content": {{
      "viewpoint": "🎯 我的观点：...",
      "evidence": "📚 我的依据：..."
    }}
  }},
  "card_b": {{
    "title": "思维方式与训练建议",
    "content": {{
      "thinking_path": "🧠 我为什么会这样思考：...",
      "training_tip": "🧩 你也可以这样练：..."
    }}
  }}
}}
"""
    return prompt

def build_black_prompt(question, yellow_viewpoint):
    prompt = f"""
你是“黑帽思维者”，你擅长从问题中识别风险、隐患、失败代价，以及不能被轻易忽视的误判。
你不唱反调，但你习惯先问：“这里有什么我忽略的风险？”“这个方案失败的代价是否能承受？”

请你就着黄帽的观点进行反思，指出其中可能忽视的部分或隐含的风险。

用户的问题是：{question}
黄帽给出的观点是：{yellow_viewpoint}

请按以下四段进行回答：

### ⚠️ 1. 【我的担忧】
请针对黄帽的观点提出你的担忧，你认为乐观背后可能隐藏的失败风险是什么？

### 📌 2. 【我的依据】
说明你为什么这样担心，你参考了哪些失败案例、常识偏差、系统性风险或用户反应？

### 🧠 3. 【我为什么会这样思考】
请从黑帽的视角解释你是如何识别出这些风险的。
你可以说明：
- 黑帽通常关注什么（脆弱点？不可控变量？失败代价？）
- 在这个问题里，你是怎么挖掘出“不可轻忽的代价”的？
- 这反映了黑帽惯常的什么思维方式？

### 🧩 4. 【你也可以这样练】
请提供一个简洁、有指向性的练习建议，帮助用户像黑帽一样思考：
- 如何辨别乐观方案中可能的风险？
- 如何从“失败场景”推演关键失控点？
- 如何练习提出“预警思考”？

请将你的回答封装为 JSON 对象，结构如下：
{{
  "card_c": {{
    "title": "问题的反向质疑",
    "content": {{
      "doubt": "⚠️ 我的担忧：...",
      "evidence": "📌 我的依据：..."
    }}
  }},
  "card_d": {{
    "title": "谨慎思维方式与训练建议",
    "content": {{
      "thinking_path": "🧠 我为什么会这样思考：...",
      "training_tip": "🧩 你也可以这样练：..."
    }}
  }}
}}
"""
    return prompt


